
<div id="app">
    <div class="d-flex justify-content-between">
        <div>
            <label>設備種類  </label>
            <select class="btn btn-light dropdown-toggle" v-on:change="onCategoryChange($event)">
                <option disabled selected>請先選擇種類</option>
                <option v-for="cname in category" :value="cname.equipCategoryId">{{cname.categoryName}}</option>
            </select>
        </div>

        <div>
            <label>設備名稱  </label>
            <select class="btn btn-light dropdown-toggle" v-on:change="onEquipNameChange($event)" v-model="selectName">
                <option disabled selected>請選擇名稱</option>
                <option v-for="ename in equips" :value="ename">{{ename}}</option>
            </select>
        </div>

        @*查詢Btn*@
        <div>
            <button type="button" class="btn btn-outline-primary" v-on:click="btnQry">查詢 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M14.53 15.59a8.25 8.25 0 111.06-1.06l5.69 5.69a.75.75 0 11-1.06 1.06l-5.69-5.69zM2.5 9.25a6.75 6.75 0 1111.74 4.547.746.746 0 00-.443.442A6.75 6.75 0 012.5 9.25z"></path></svg></button>
        </div>

        @*管理員btn*@
        <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
            @*新增*@
            <button type="button" class="btn btn-success" onclick="self.location.href='/Equips/backendManagement/'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M12.75 7.75a.75.75 0 00-1.5 0v3.5h-3.5a.75.75 0 000 1.5h3.5v3.5a.75.75 0 001.5 0v-3.5h3.5a.75.75 0 000-1.5h-3.5v-3.5z"></path><path fill-rule="evenodd" d="M12 1C5.925 1 1 5.925 1 12s4.925 11 11 11 11-4.925 11-11S18.075 1 12 1zM2.5 12a9.5 9.5 0 1119 0 9.5 9.5 0 01-19 0z"></path></svg> 新增</button>
            @*刪除*@
            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteAllEquipModal">刪除 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M2.5 12a9.5 9.5 0 1119 0 9.5 9.5 0 01-19 0zM12 1C5.925 1 1 5.925 1 12s4.925 11 11 11 11-4.925 11-11S18.075 1 12 1zm6.25 11.75a.75.75 0 000-1.5H5.75a.75.75 0 000 1.5h12.5z"></path></svg></button>
        </div>
    </div>
</div>
<br />
<div id="view">
    <fieldset class="form-group border w-auto">
        <legend>設備資料查詢結果 筆數:{{equips.length}}</legend>
        <table class="table table-hover">
            <thead class="badge-secondary">
                <tr>
                    <td>&#9746;</td>
                    <td>序號</td>
                    <td>名稱</td>
                    <td>品牌</td>
                    <td>型號</td>
                    <td>單價</td>
                    <td>出租/待領/在庫/總數</td>
                    <td>描述</td>
                    <td>修改</td>
                </tr>
            </thead>
            <tbody>
                <tr v-for="equip in equips" v-if="equips.length !==0">
                    <td><input type="checkbox" aria-label="Checkbox" :value="equip" v-model="checkedEquips"></td>
                    <td>{{equip.equipmentSn}}</td>
                    <td>{{equip.equipmentName}}</td>
                    <td>{{equip.brand}}</td>
                    <td>{{equip.model}}</td>
                    <td>{{equip.unitPrice}}</td>
                    <td><button type="button" class="btn btn-outline-primary" :value="equip.equipmentId" v-on:click="btnItem">&#10148; {{equip.quantityUsable-equip.quantityInStock-equip.quantityReserved}} / {{equip.quantityReserved}} / {{equip.quantityInStock}} / {{equip.quantityUsable}}</button></td>
                    <td>{{equip.description}}</td>
                    <td><a @@click="updateClickEquip(equip)" data-toggle="modal" data-target="#equipUpdateModal"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M17.263 2.177a1.75 1.75 0 012.474 0l2.586 2.586a1.75 1.75 0 010 2.474L19.53 10.03l-.012.013L8.69 20.378a1.75 1.75 0 01-.699.409l-5.523 1.68a.75.75 0 01-.935-.935l1.673-5.5a1.75 1.75 0 01.466-.756L14.476 4.963l2.787-2.786zm-2.275 4.371l-10.28 9.813a.25.25 0 00-.067.108l-1.264 4.154 4.177-1.271a.25.25 0 00.1-.059l10.273-9.806-2.94-2.939zM19 8.44l2.263-2.262a.25.25 0 000-.354l-2.586-2.586a.25.25 0 00-.354 0L16.061 5.5 19 8.44z"></path></svg></a></td>

                </tr>
            </tbody>
        </table>

    </fieldset>
    <br />
    <fielset class="form-group border w-auto">
        <legend class="d-flex justify-content-between">
            物品明細查詢結果 筆數:{{items.length}}
            <div>
                <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
                    @*新增*@
                    <button type="button" class="btn btn-success" onclick="self.location.href='/Equips/backendManagement/'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M12.75 7.75a.75.75 0 00-1.5 0v3.5h-3.5a.75.75 0 000 1.5h3.5v3.5a.75.75 0 001.5 0v-3.5h3.5a.75.75 0 000-1.5h-3.5v-3.5z"></path><path fill-rule="evenodd" d="M12 1C5.925 1 1 5.925 1 12s4.925 11 11 11 11-4.925 11-11S18.075 1 12 1zM2.5 12a9.5 9.5 0 1119 0 9.5 9.5 0 01-19 0z"></path></svg> 新增</button>
                    @*刪除*@
                    <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteAllItemModal">刪除 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M2.5 12a9.5 9.5 0 1119 0 9.5 9.5 0 01-19 0zM12 1C5.925 1 1 5.925 1 12s4.925 11 11 11 11-4.925 11-11S18.075 1 12 1zm6.25 11.75a.75.75 0 000-1.5H5.75a.75.75 0 000 1.5h12.5z"></path></svg></button>
                </div>
            </div>
        </legend>
        <table class="table table-hover">
            <thead class="badge-secondary">
                <tr>
                    <td>&#9746;</td>
                    <td>序號</td>
                    <td>描述</td>
                    <td>狀態</td>
                    <td>修改</td>
                    <td>查看紀錄</td>
                </tr>
            </thead>
            <tbody>
                <tr v-for="item in items" v-if="items.length !==0">
                    <td><input type="checkbox" aria-label="Checkbox" :value="item" v-model="checkedItems"></td>
                    <td>{{item.itemSn}}</td>
                    <td>{{item.description}}</td>
                    <td>{{item.condition}}</td>
                    <td><a @@click="updateClickItem(item)" data-toggle="modal" data-target="#itemUpdateModal"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M17.263 2.177a1.75 1.75 0 012.474 0l2.586 2.586a1.75 1.75 0 010 2.474L19.53 10.03l-.012.013L8.69 20.378a1.75 1.75 0 01-.699.409l-5.523 1.68a.75.75 0 01-.935-.935l1.673-5.5a1.75 1.75 0 01.466-.756L14.476 4.963l2.787-2.786zm-2.275 4.371l-10.28 9.813a.25.25 0 00-.067.108l-1.264 4.154 4.177-1.271a.25.25 0 00.1-.059l10.273-9.806-2.94-2.939zM19 8.44l2.263-2.262a.25.25 0 000-.354l-2.586-2.586a.25.25 0 00-.354 0L16.061 5.5 19 8.44z"></path></svg></a></td>
                    <td><a @@click="itemLog(item)" data-toggle="modal" data-target="#itemLogModal"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M3.75 5.5a.75.75 0 000 1.5h10a.75.75 0 000-1.5h-10zm5 6a.75.75 0 000 1.5h11.5a.75.75 0 000-1.5H8.75zm0 6a.75.75 0 000 1.5h11.5a.75.75 0 000-1.5H8.75zM5 12a1 1 0 11-2 0 1 1 0 012 0zm-1 7a1 1 0 100-2 1 1 0 000 2z"></path><path d="M19.309 7.918l-2.245-2.501A.25.25 0 0117.25 5h4.49a.25.25 0 01.185.417l-2.244 2.5a.25.25 0 01-.372 0z"></path></svg></a></td>
            </tbody>
        </table>

    </fielset>


    <!-- Equip-deleteModal -->
    <div class="modal fade" id="deleteAllEquipModal" @*tabindex="-1"*@ role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title font-weight-bold text-danger" id="exampleModalLabel"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 17.5a1 1 0 11-2 0 1 1 0 012 0zm-.25-8.25a.75.75 0 00-1.5 0v4.5a.75.75 0 001.5 0v-4.5z"></path><path fill-rule="evenodd" d="M9.836 3.244c.963-1.665 3.365-1.665 4.328 0l8.967 15.504c.963 1.667-.24 3.752-2.165 3.752H3.034c-1.926 0-3.128-2.085-2.165-3.752L9.836 3.244zm3.03.751a1 1 0 00-1.732 0L2.168 19.499A1 1 0 003.034 21h17.932a1 1 0 00.866-1.5L12.866 3.994z"></path></svg> 一鍵刪除</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    確認刪除所有選取『設備』?
                    <p>欲刪除設備序號: <span class="font-weight-bolder">{{showDeleteEquips}}</span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" v-on:click="btnDelEquip">確認</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Item-deleteModal -->
    <div class="modal fade" id="deleteAllItemModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title font-weight-bold text-danger" id="exampleModalLabel"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 17.5a1 1 0 11-2 0 1 1 0 012 0zm-.25-8.25a.75.75 0 00-1.5 0v4.5a.75.75 0 001.5 0v-4.5z"></path><path fill-rule="evenodd" d="M9.836 3.244c.963-1.665 3.365-1.665 4.328 0l8.967 15.504c.963 1.667-.24 3.752-2.165 3.752H3.034c-1.926 0-3.128-2.085-2.165-3.752L9.836 3.244zm3.03.751a1 1 0 00-1.732 0L2.168 19.499A1 1 0 003.034 21h17.932a1 1 0 00.866-1.5L12.866 3.994z"></path></svg> 一鍵刪除</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    確認刪除所有選取『物品』?
                    <p>欲刪除物品序號: <span class="font-weight-bolder">{{showDeleteItems}}</span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" v-on:click="btnDelItem">確認</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Equip-updateModal -->
    <div class="modal fade" id="equipUpdateModal" @*tabindex="-1"*@ role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M16 12a4 4 0 11-8 0 4 4 0 018 0zm-1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path><path fill-rule="evenodd" d="M12 1c-.268 0-.534.01-.797.028-.763.055-1.345.617-1.512 1.304l-.352 1.45c-.02.078-.09.172-.225.22a8.45 8.45 0 00-.728.303c-.13.06-.246.044-.315.002l-1.274-.776c-.604-.368-1.412-.354-1.99.147-.403.348-.78.726-1.129 1.128-.5.579-.515 1.387-.147 1.99l.776 1.275c.042.069.059.185-.002.315-.112.237-.213.48-.302.728-.05.135-.143.206-.221.225l-1.45.352c-.687.167-1.249.749-1.304 1.512a11.149 11.149 0 000 1.594c.055.763.617 1.345 1.304 1.512l1.45.352c.078.02.172.09.22.225.09.248.191.491.303.729.06.129.044.245.002.314l-.776 1.274c-.368.604-.354 1.412.147 1.99.348.403.726.78 1.128 1.129.579.5 1.387.515 1.99.147l1.275-.776c.069-.042.185-.059.315.002.237.112.48.213.728.302.135.05.206.143.225.221l.352 1.45c.167.687.749 1.249 1.512 1.303a11.125 11.125 0 001.594 0c.763-.054 1.345-.616 1.512-1.303l.352-1.45c.02-.078.09-.172.225-.22.248-.09.491-.191.729-.303.129-.06.245-.044.314-.002l1.274.776c.604.368 1.412.354 1.99-.147.403-.348.78-.726 1.129-1.128.5-.579.515-1.387.147-1.99l-.776-1.275c-.042-.069-.059-.185.002-.315.112-.237.213-.48.302-.728.05-.135.143-.206.221-.225l1.45-.352c.687-.167 1.249-.749 1.303-1.512a11.125 11.125 0 000-1.594c-.054-.763-.616-1.345-1.303-1.512l-1.45-.352c-.078-.02-.172-.09-.22-.225a8.469 8.469 0 00-.303-.728c-.06-.13-.044-.246-.002-.315l.776-1.274c.368-.604.354-1.412-.147-1.99-.348-.403-.726-.78-1.128-1.129-.579-.5-1.387-.515-1.99-.147l-1.275.776c-.069.042-.185.059-.315-.002a8.465 8.465 0 00-.728-.302c-.135-.05-.206-.143-.225-.221l-.352-1.45c-.167-.687-.749-1.249-1.512-1.304A11.149 11.149 0 0012 1zm-.69 1.525a9.648 9.648 0 011.38 0c.055.004.135.05.162.16l.351 1.45c.153.628.626 1.08 1.173 1.278.205.074.405.157.6.249a1.832 1.832 0 001.733-.074l1.275-.776c.097-.06.186-.036.228 0 .348.302.674.628.976.976.036.042.06.13 0 .228l-.776 1.274a1.832 1.832 0 00-.074 1.734c.092.195.175.395.248.6.198.547.652 1.02 1.278 1.172l1.45.353c.111.026.157.106.161.161a9.653 9.653 0 010 1.38c-.004.055-.05.135-.16.162l-1.45.351a1.833 1.833 0 00-1.278 1.173 6.926 6.926 0 01-.25.6 1.832 1.832 0 00.075 1.733l.776 1.275c.06.097.036.186 0 .228a9.555 9.555 0 01-.976.976c-.042.036-.13.06-.228 0l-1.275-.776a1.832 1.832 0 00-1.733-.074 6.926 6.926 0 01-.6.248 1.833 1.833 0 00-1.172 1.278l-.353 1.45c-.026.111-.106.157-.161.161a9.653 9.653 0 01-1.38 0c-.055-.004-.135-.05-.162-.16l-.351-1.45a1.833 1.833 0 00-1.173-1.278 6.928 6.928 0 01-.6-.25 1.832 1.832 0 00-1.734.075l-1.274.776c-.097.06-.186.036-.228 0a9.56 9.56 0 01-.976-.976c-.036-.042-.06-.13 0-.228l.776-1.275a1.832 1.832 0 00.074-1.733 6.948 6.948 0 01-.249-.6 1.833 1.833 0 00-1.277-1.172l-1.45-.353c-.111-.026-.157-.106-.161-.161a9.648 9.648 0 010-1.38c.004-.055.05-.135.16-.162l1.45-.351a1.833 1.833 0 001.278-1.173 6.95 6.95 0 01.249-.6 1.832 1.832 0 00-.074-1.734l-.776-1.274c-.06-.097-.036-.186 0-.228.302-.348.628-.674.976-.976.042-.036.13-.06.228 0l1.274.776a1.832 1.832 0 001.734.074 6.95 6.95 0 01.6-.249 1.833 1.833 0 001.172-1.277l.353-1.45c.026-.111.106-.157.161-.161z"></path></svg> 修改設備</h5>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label class="col-form-label">種類</label>
                            <select class="form-control" v-on:change="onEditCategoryChange($event)">
                                <option v-for="cname in app.category"
                                        :value="cname.equipCategoryId"
                                        :selected="cname.equipCategoryId===tempEquipDetail.equipmentCategoryId">
                                    {{cname.categoryName}}
                                </option>
                            </select>

                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備序號</label>
                            <input type="text" class="form-control" v-model="tempEquipDetail.equipmentSn" required>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備名稱</label>
                            <input type="text" class="form-control" v-model="tempEquipDetail.equipmentName" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label class="col-form-label">設備品牌</label>
                            <input type="text" class="form-control" v-model="tempEquipDetail.brand">
                        </div>
                        <div class="form-group col-md-6">
                            <label class="col-form-label">設備型號</label>
                            <input type="text" class="form-control" v-model="tempEquipDetail.model">
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備單價</label>
                            <input type="text" class="form-control" v-model="tempEquipDetail.unitPrice">
                        </div>
                        <div class="form-group col-md-8">
                            <label class="col-form-label">設備描述</label>
                            <input type="text" class="form-control" v-model="tempEquipDetail.description">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" @@click="updateSaveChangeEquip">儲存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Item-updateModal -->
    <div class="modal fade" id="itemUpdateModal" @*tabindex="-1"*@ role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M16 12a4 4 0 11-8 0 4 4 0 018 0zm-1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path><path fill-rule="evenodd" d="M12 1c-.268 0-.534.01-.797.028-.763.055-1.345.617-1.512 1.304l-.352 1.45c-.02.078-.09.172-.225.22a8.45 8.45 0 00-.728.303c-.13.06-.246.044-.315.002l-1.274-.776c-.604-.368-1.412-.354-1.99.147-.403.348-.78.726-1.129 1.128-.5.579-.515 1.387-.147 1.99l.776 1.275c.042.069.059.185-.002.315-.112.237-.213.48-.302.728-.05.135-.143.206-.221.225l-1.45.352c-.687.167-1.249.749-1.304 1.512a11.149 11.149 0 000 1.594c.055.763.617 1.345 1.304 1.512l1.45.352c.078.02.172.09.22.225.09.248.191.491.303.729.06.129.044.245.002.314l-.776 1.274c-.368.604-.354 1.412.147 1.99.348.403.726.78 1.128 1.129.579.5 1.387.515 1.99.147l1.275-.776c.069-.042.185-.059.315.002.237.112.48.213.728.302.135.05.206.143.225.221l.352 1.45c.167.687.749 1.249 1.512 1.303a11.125 11.125 0 001.594 0c.763-.054 1.345-.616 1.512-1.303l.352-1.45c.02-.078.09-.172.225-.22.248-.09.491-.191.729-.303.129-.06.245-.044.314-.002l1.274.776c.604.368 1.412.354 1.99-.147.403-.348.78-.726 1.129-1.128.5-.579.515-1.387.147-1.99l-.776-1.275c-.042-.069-.059-.185.002-.315.112-.237.213-.48.302-.728.05-.135.143-.206.221-.225l1.45-.352c.687-.167 1.249-.749 1.303-1.512a11.125 11.125 0 000-1.594c-.054-.763-.616-1.345-1.303-1.512l-1.45-.352c-.078-.02-.172-.09-.22-.225a8.469 8.469 0 00-.303-.728c-.06-.13-.044-.246-.002-.315l.776-1.274c.368-.604.354-1.412-.147-1.99-.348-.403-.726-.78-1.128-1.129-.579-.5-1.387-.515-1.99-.147l-1.275.776c-.069.042-.185.059-.315-.002a8.465 8.465 0 00-.728-.302c-.135-.05-.206-.143-.225-.221l-.352-1.45c-.167-.687-.749-1.249-1.512-1.304A11.149 11.149 0 0012 1zm-.69 1.525a9.648 9.648 0 011.38 0c.055.004.135.05.162.16l.351 1.45c.153.628.626 1.08 1.173 1.278.205.074.405.157.6.249a1.832 1.832 0 001.733-.074l1.275-.776c.097-.06.186-.036.228 0 .348.302.674.628.976.976.036.042.06.13 0 .228l-.776 1.274a1.832 1.832 0 00-.074 1.734c.092.195.175.395.248.6.198.547.652 1.02 1.278 1.172l1.45.353c.111.026.157.106.161.161a9.653 9.653 0 010 1.38c-.004.055-.05.135-.16.162l-1.45.351a1.833 1.833 0 00-1.278 1.173 6.926 6.926 0 01-.25.6 1.832 1.832 0 00.075 1.733l.776 1.275c.06.097.036.186 0 .228a9.555 9.555 0 01-.976.976c-.042.036-.13.06-.228 0l-1.275-.776a1.832 1.832 0 00-1.733-.074 6.926 6.926 0 01-.6.248 1.833 1.833 0 00-1.172 1.278l-.353 1.45c-.026.111-.106.157-.161.161a9.653 9.653 0 01-1.38 0c-.055-.004-.135-.05-.162-.16l-.351-1.45a1.833 1.833 0 00-1.173-1.278 6.928 6.928 0 01-.6-.25 1.832 1.832 0 00-1.734.075l-1.274.776c-.097.06-.186.036-.228 0a9.56 9.56 0 01-.976-.976c-.036-.042-.06-.13 0-.228l.776-1.275a1.832 1.832 0 00.074-1.733 6.948 6.948 0 01-.249-.6 1.833 1.833 0 00-1.277-1.172l-1.45-.353c-.111-.026-.157-.106-.161-.161a9.648 9.648 0 010-1.38c.004-.055.05-.135.16-.162l1.45-.351a1.833 1.833 0 001.278-1.173 6.95 6.95 0 01.249-.6 1.832 1.832 0 00-.074-1.734l-.776-1.274c-.06-.097-.036-.186 0-.228.302-.348.628-.674.976-.976.042-.036.13-.06.228 0l1.274.776a1.832 1.832 0 001.734.074 6.95 6.95 0 01.6-.249 1.833 1.833 0 001.172-1.277l.353-1.45c.026-.111.106-.157.161-.161z"></path></svg> 修改物品</h5>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備序號</label>
                            <input type="text" class="form-control" v-model="itemDetail.equipmentSn" readonly>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備名稱</label>
                            <input type="text" class="form-control" v-model="itemDetail.equipmentName" readonly>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">物品序號</label>
                            <input type="text" class="form-control" v-model="itemDetail.itemSn" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label class="col-form-label">物品描述</label>
                            <input type="text" class="form-control" v-model="itemDetail.description">
                        </div>
                        <div class="form-group col-md-6">
                            <label class="col-form-label">物品狀態 </label>
                            <input type="text" class="form-control" v-model="itemDetail.condition" readonly>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" @@click="updateSaveChangeItem">儲存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ItemLog-Modal -->
    <div class="modal fade" id="itemLogModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M11.47 5.22a.75.75 0 011.06 0l3.25 3.25a.75.75 0 01-1.06 1.06L12 6.81 9.28 9.53a.75.75 0 01-1.06-1.06l3.25-3.25z"></path><path fill-rule="evenodd" d="M12 5.5a.75.75 0 01.75.75v8a.75.75 0 01-1.5 0v-8A.75.75 0 0112 5.5zM10.75 18a.75.75 0 01.75-.75h1a.75.75 0 010 1.5h-1a.75.75 0 01-.75-.75zm-8 0a.75.75 0 01.75-.75h1a.75.75 0 010 1.5h-1a.75.75 0 01-.75-.75zm12 0a.75.75 0 01.75-.75h1a.75.75 0 010 1.5h-1a.75.75 0 01-.75-.75zm-8 0a.75.75 0 01.75-.75h1a.75.75 0 010 1.5h-1a.75.75 0 01-.75-.75zm12 0a.75.75 0 01.75-.75h1a.75.75 0 010 1.5h-1a.75.75 0 01-.75-.75z"></path></svg> ItemLog</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <ul>
                        <li v-for="detail in itemLogDetails">
                            <span class="font-weight-bolder">Log序號: </span>{{detail.itemLogSn}} ,
                            <span class="font-weight-bolder">物品序號: </span>{{detail.itemSn}} ,
                            <span class="font-weight-bolder">物品狀態: </span><span class="font-weight-bolder text-danger">{{detail.conditionName}}</span> ,
                            <span v-if="detail.orderDetailSn!=null"><span class="font-weight-bolder">訂單明細序號: </span><a href="/Order/orderManageAdmin/" class="text-primary">{{detail.orderDetailSn}}</a> ,</span>
                            <span class="font-weight-bolder">管理員: </span>{{detail.adminUsername}} {{detail.adminFullName}} ,
                            <span v-if="detail.description!=null"><span class="font-weight-bolder">描述: </span>{{detail.description}} ,</span>
                            <span class="font-weight-bolder">異動時間: </span>{{detail.createTime}}
                        </li>
                    </ul>
                </div>

            </div>
        </div>
    </div>

    
</div>
<script>
    //let EquipApi = {
    //    getCategory : ()=> {
    //        return await fetch('/equipapi/GetCates');
    //    }
    //}
    var app = new Vue({
        el: '#app',
        data: {
            category: {},
            equips: {},
            selectName: '',
            selectVal: '',
            categoryId:''
        },
        beforeCreate: function () {
            fetch('/EquipCategoryApi/GetCates', { method: 'GET' })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                })
                .then(response => {
                    this.category = response;
                });

        },
        methods: {
            onCategoryChange: function (data) {
                this.categoryId = data.target.value;
                fetch('/equipapi/GetEquipNamesByCatesId/' + data.target.value, { method: 'GET' })
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                    })
                    .then(response => {
                        this.equips = response;
                    })
            },
            onEquipNameChange: function (e) {
                // 可以抓到選到的option的value，而不是text
                this.selectVal = e.target.value;
                /*console.log(this.selectVal);*/
                view.checkedEquips = [];

            },
            btnQry: function () {
                let url = '/EquipApi/GetEquipByCateOrName/' + this.categoryId + '/' + this.selectVal;
                let request = {
                    method: 'GET',
                    headers: { 'content-type': 'application/json' }
                };
                
                fetch(url, request)
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                        return response.text();
                    })
                    .then(response => {
                        view.equips = response;
                        app.selectName = '';
                        app.selectVal = '';
                        view.items = '';
                    });
            }
        }
    })
    var view = new Vue({
        el: '#view',
        data: {
            equips: '',
            eid: '',
            items: '',
            checkedEquips: [],
            checkedItems: [],
            tempEquipDetail: {

            },
            itemDetail: {
                equipmentSn:'',
                equipmentName:'',
                itemId: '',
                itemSn: '',
                description: '',
                condition: ''
            },
            
            itemLogDetails: {
                
            }
        },
        methods: {
            btnItem: function (e) {
                this.eid = e.target.value;

                let url = '/ItemApi/GetItemsByEquipId/' + this.eid;
                let request = {
                    method: 'GET',
                    headers: { 'content-type': 'application/json' }
                }
                fetch(url, request)
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                        return response.text();
                    })
                    .then(response => {
                        this.items = response;
                        this.checkedItems = [];
                    })
            },
            btnDelEquip: function () {
                let url = '/EquipApi/RemoveEquipByIds/';
                let deleteEuipids = this.checkedEquips.map((x) => {
                    return x.equipmentId;
                })
                let request = {
                    method: 'Delete',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify(deleteEuipids)
                }
                fetch(url, request)
                    .then(response => {
                        return response.json();
                    })
                    .then(data => {

                        if (data === 0) {
                            alert("刪除失敗!!!");
                        } else {
                            alert("刪除" + data + "筆");
                            $("#deleteAllEquipModal").modal("hide");
                            view.equips = view.equips.filter((x) => {
                                /*y為checkedItems的每一筆*/
                                return !this.checkedEquips.some(function (y) {
                                    return y.equipmentId == x.equipmentId
                                })
                            });

                            /*window.location.reload(true);*/
                        }
                    })
            },
            btnDelItem: function () {
                let url = '/ItemApi/RemoveItemsByIds/';
                let deleteItemids = this.checkedItems.map((x) => {
                    return x.itemId;
                })
                let request = {
                    method: 'Delete',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify(deleteItemids)
                }
                fetch(url, request)
                    .then(response => {
                        return response.json();
                    })
                    .then(data => {
                        if (data === 0) {
                            alert("刪除失敗!!!");
                        } else {
                            alert("刪除" + data + "筆");
                            $("#deleteAllItemModal").modal("hide");
                            view.items = view.items.filter((x) => {
                                /*y為checkedItems的每一筆*/
                                return !this.checkedItems.some(function (y) {
                                    return y.itemId == x.itemId
                                })
                            });
                            view.checkedItems = [];
                        }
                    })
            },
            updateClickEquip: function (equipmentData) {
                this.tempEquipDetail = Object.assign({}, equipmentData);
            },
            updateSaveChangeEquip: function (equipmentData) {
                let url = '/EquipApi/EditEquip/' + this.tempEquipDetail.equipmentId;
                let request = {
                    method: 'PUT',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify(this.tempEquipDetail)
                }
                fetch(url, request)
                    .then(response => {
                        if (response.ok) {
                            alert("修改成功,請確認資料!!!");
                            $("#equipUpdateModal").modal("hide");
                            for (i = 0; i < view.equips.length; i++)
                            {
                                if (view.equips[i].equipmentId == this.tempEquipDetail.equipmentId) {
                                    view.equips[i] = Object.assign({}, this.tempEquipDetail);
                                }
                            }
                            view.$forceUpdate();
                            //view.equips = view.equips.filter((x) =>
                            //{
                            //    if (x.equipmentId == view.tempEquipDetail.equipmentId) {
                            //        return view.tempEquipDetail;
                            //    }
                            //    else {
                            //        return x;
                            //    }
                                
                            //});
                            
                            console.log(view.equips);
                        } else {
                            alert("修改失敗");
                        }

                    })

            },

            onEditCategoryChange: function (data) {
                /*console.log(data.target.value);*/
                this.tempEquipDetail.equipmentCategoryId = data.target.value;
            },

            updateClickItem: function (itemData) {
                console.log(itemData);
                let temp = {
                    equipmentSn: itemData.equipmentSn,
                    equipmentName: itemData.equipmentName,
                    itemId: itemData.itemId,
                    itemSn: itemData.itemSn,
                    description: itemData.description,
                    condition: itemData.condition
                };
                this.itemDetail = temp;
            },

            updateSaveChangeItem: function (itemData) {
                let url = '/ItemApi/EditItem/' + this.itemDetail.itemId;
                let request = {
                    method: 'PUT',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify(this.itemDetail)
                }
                fetch(url, request)
                    .then(response => {
                        if (response.ok) {
                            alert("修改成功,請確認資料!!!");
                            $("#itemUpdateModal").modal("hide");
                            for (i = 0; i < view.items.length; i++) {
                                if (view.items[i].itemId == this.itemDetail.itemId) {
                                    view.items[i] = Object.assign({}, this.itemDetail);
                                }
                            }
                            view.$forceUpdate();
                            
                        } else {
                            alert("修改失敗");
                        }
                    })

            },
            itemLog: function (data) {
                let url = '/ItemLogApi/GetLogsByItemId/' + data.itemId;
                let request = {
                    method: 'GET',
                    headers: { 'content-type': 'application/json' }
                }
                fetch(url, request)
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                        return response.text();
                    })
                    .then(response => {
                        view.itemLogDetails = response;
                    })
            }
                    
            

        }
        ,
        computed: {
            showDeleteEquips: function () {
                return this.checkedEquips.map((x) => {
                    return x.equipmentSn
                })
            },
            showDeleteItems: function () {
                return this.checkedItems.map((x) => {
                    return x.itemSn
                })
            }
        }
    })
</script>

