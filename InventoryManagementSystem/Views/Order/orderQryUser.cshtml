<link type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
<link type="text/css"
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css" />


<script src="https://unpkg.com/vue"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>



<div id="app">
    <b-card>
        <b-tabs content-class="mt-3" fill v-model="tabIndex">
            <!-- 待核可 -->
            <b-tab title="待核可" active v-on:click="tab($event)">
                <div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>訂單ID</th>
                                <th>設備序號</th>
                                <th>設備名稱</th>
                                <th>數量</th>
                                <th>預計取貨時間</th>
                                <th>租借天數</th>
                                <th>總價</th>
                                <th>訂單狀態</th>
                                <th>下單時間</th>
                                <th>取消租借</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="order in orders_0">
                                <td>{{order.orderId}}</td>
                                <td>{{order.equipmentSn}}</td>
                                <td>{{order.equipmentName}}</td>
                                <td>{{order.quantity}}</td>
                                <td>{{order.estimatedPickupTime | timeString('YYYY-MM-DD')}}</td>
                                <td>{{order.day}}</td>
                                <td>{{order.unitPrice * order.day * order.quantity}}</td>
                                <td>處理中</td>
                                <td>{{order.orderTime | timeString('YYYY-MM-DD')}}</td>
                                <td><b-btn  data-toggle="modal" data-target="#cancelModal">取消租借</b-btn></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </b-tab>

            <!-- 待領取 -->
            <b-tab title="待領取" v-on:click="tab($event)">
                <div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>訂單ID</th>
                                <th>設備序號</th>
                                <th>設備名稱</th>
                                <th>數量</th>
                                <th>預計取貨時間</th>
                                <th>租借天數</th>
                                <th>總價</th>
                                <th>訂單狀態</th>
                                <th>下單時間</th>
                                <th>取消租借</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="order in orders_1">
                                <td>{{order.orderId}}</td>
                                <td>{{order.equipmentSn}}</td>
                                <td>{{order.equipmentName}}</td>
                                <td>{{order.quantity}}</td>
                                <td>{{order.estimatedPickupTime | timeString('YYYY-MM-DD')}}</td>
                                <td>{{order.day}}</td>
                                <td>{{order.unitPrice * order.day * order.quantity}}</td>
                                <td>待領取</td>
                                <td>{{order.orderTime | timeString('YYYY-MM-DD')}}</td>
                                <td><b-btn data-toggle="modal" data-target="#cancelModal">取消租借</b-btn></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </b-tab>

            <!-- 租借中 -->
            <b-tab title="租借中" v-on:click="tab($event)">
                <div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>訂單ID</th>
                                <th>設備序號</th>
                                <th>設備名稱</th>
                                <th>數量</th>
                                <th>預計取貨時間</th>
                                <th>租借天數</th>
                                <th>總價</th>
                                <th>訂單狀態</th>
                                <th>下單時間</th>
                                <th>問題回報</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="order in orders_2">
                                <td>{{order.orderId}}</td>
                                <td>{{order.equipmentSn}}</td>
                                <td>{{order.equipmentName}}</td>
                                <td>{{order.quantity}}</td>
                                <td>{{order.estimatedPickupTime | timeString('YYYY-MM-DD')}}</td>
                                <td>{{order.day}}</td>
                                <td>{{order.unitPrice * order.day * order.quantity}}</td>
                                <td>租借中</td>
                                <td>{{order.orderTime | timeString('YYYY-MM-DD')}}</td>
                                <td><b-btn data-toggle="modal" data-target="#reportModal">問題回報</b-btn></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </b-tab>

            <!-- 已結束 -->
            <b-tab title="已結束" v-on:click="tab($event)">
                <div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>訂單ID</th>
                                <th>設備序號</th>
                                <th>設備名稱</th>
                                <th>數量</th>
                                <th>預計取貨時間</th>
                                <th>租借天數</th>
                                <th>總價</th>
                                <th>訂單狀態</th>
                                <th>下單時間</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="order in orders_3">
                                <td>{{order.orderId}}</td>
                                <td>{{order.equipmentSn}}</td>
                                <td>{{order.equipmentName}}</td>
                                <td>{{order.quantity}}</td>
                                <td>{{order.estimatedPickupTime | timeString('YYYY-MM-DD')}}</td>
                                <td>{{order.day}}</td>
                                <td>{{order.unitPrice * order.day * order.quantity}}</td>
                                <td>已歸還</td>
                                <td>{{order.orderTime | timeString('YYYY-MM-DD')}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </b-tab>

            <!-- 已結束 -->
            <b-tab title="已逾期" v-on:click="tab($event)">
                <div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>訂單ID</th>
                                <th>設備序號</th>
                                <th>設備名稱</th>
                                <th>數量</th>
                                <th>預計取貨時間</th>
                                <th>租借天數</th>
                                <th>總價</th>
                                <th>訂單狀態</th>
                                <th>下單時間</th>
                                <th>問題回報</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="order in orders_4">
                                <td>{{order.orderId}}</td>
                                <td>{{order.equipmentSn}}</td>
                                <td>{{order.equipmentName}}</td>
                                <td>{{order.quantity}}</td>
                                <td>{{order.estimatedPickupTime | timeString('YYYY-MM-DD')}}</td>
                                <td>{{order.day}}</td>
                                <td>{{order.unitPrice * order.day * order.quantity}}</td>
                                <td>已逾期</td>
                                <td>{{order.orderTime | timeString('YYYY-MM-DD')}}</td>
                                <td><b-btn data-toggle="modal" data-target="#reportModal">問題回報</b-btn></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </b-tab>
        </b-tabs>
    </b-card>

    <!-- 問題反映Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title font-weight-bold text-danger" id="exampleModalLabel">問題報修</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label class="col-form-label">訂單編號</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備名稱</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備序號</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">物品序號</label>
                        <input type="text" class="form-control" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary">前往設備報修問卷</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 取消訂單Modal -->
    <div class="modal fade" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title font-weight-bold text-danger" id="exampleModalLabel">取消租借</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label class="col-form-label">訂單編號</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備名稱</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">設備序號</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-2">
                            <label class="col-form-label">數量</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                        <div class="form-group col-md-4">
                            <label class="col-form-label">取貨日期</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                        <div class="form-group col-md-2">
                            <label class="col-form-label">租借天數</label>
                            <input type="text" class="form-control" readonly>
                        </div>

                        <div class="form-group col-md-4">
                            <label class="col-form-label">總金額</label>
                            <input type="text" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <label class="col-form-label">取消原因</label>
                            <input type="text" class="form-control" required>
                        </div>
                    </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary">確定</button>
                        </div>
                    </div>
                </div>
        </div>
    </div>


</div>


<script>
    Vue.filter('timeString', function (value, myFormat) {
        return moment(value).format(myFormat || 'YYYY-MM-DD, HH:mm:ss');
    });
    var app = new Vue({

        el: '#app',
        data: {
            orders_0: [],
            orders_1: [],
            orders_2: [],
            orders_3: [],
            orders_4: [],
            tabIndex: 0,
            currentTab: ["待核可", "待領取", "租借中", "已結束", "已逾期"],
            

        },

        beforeCreate: function () {
            let url = '/OrderApi/GetOrders/待核可';
            fetch(url, { method: 'GET' })
                .then(response => {
                    if (response.ok) {
                        console.log("資料庫連線成功");
                        return response.json();

                    } else {
                        console.log("資料擷取失敗");
                    }
                }).then(response => {
                    console.log(response);
                    this.orders_0 = response;

                }
                ).catch(error => {
                    alert("資料庫連線失敗");
                    console.log(error);
                })
        },

        methods: {

            tab: function () {
                
                let url = '/OrderApi/GetOrders/' + this.currentTab[this.tabIndex];
                let request = {
                    method: "GET",
                    headers: {
                        "content-type": "application/json"
                    }
                }
                fetch(url, request)
                    .then(response => {
                        if (response.ok) {
                            console.log("資料庫連線成功");
                            return response.json();

                        } else {
                            console.log("資料擷取失敗");
                        }
                    }).then(response => {
                        console.log(response);
                        switch (this.tabIndex) {
                            case 0:
                                this.orders_0 = response;
                            case 1:
                                this.orders_1 = response;
                            case 2:
                                this.orders_2 = response;
                            case 3:
                                this.orders_3 = response;
                            case 4:
                                this.orders_4 = response;
                        }
                    }
                    ).catch(error => {
                        alert("資料庫連線失敗");
                        console.log(error);
                    })

            }


            

        }

        


        
    })

 
</script> 